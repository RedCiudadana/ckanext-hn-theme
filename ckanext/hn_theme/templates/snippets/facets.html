{#
  facets.html - versión mejorada para ckanext-hn-theme
  Diseño moderno, accesible y visualmente claro
#}

<div class="custom-facets space-y-4">

    {% for facet in facet_titles %}
    {% set title = facet_titles[facet] %}
    {% set facet_data = search_facets.get(facet) %}
    {% if facet_data and facet_data.items() %}

    <section class="facet-section bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden transition-shadow hover:shadow-md">
        {# --- Encabezado con ícono (opcional) --- #}
        <div class="facet-header px-4 py-3 bg-gray-50 border-b border-gray-200">
            <h4 class="text-sm font-semibold text-gray-800 uppercase tracking-wide flex items-center gap-2">
                {% if facet == 'organization' %}
                <i class="icon-building text-gray-600"></i>
                {% elif facet == 'tags' %}
                <i class="icon-tag text-gray-600"></i>
                {% elif facet == 'res_format' %}
                <i class="icon-file text-gray-600"></i>
                {% elif facet == 'groups' %}
                <i class="icon-group text-gray-600"></i>
                {% else %}
                <i class="icon-filter text-gray-600"></i>
                {% endif %}
                {{ title }}
            </h4>
        </div>

        {# --- Lista de valores --- #}
        <ul class="facet-list p-0 m-0 max-h-96 overflow-y-auto">
            {% for item_name, item_data in facet_data.items() %}
            <li class="facet-item px-4 py-2 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors">
                <a href="{{ h.remove_url_param(facet, item_name) if item_data.active else h.add_url_param(facet, item_name) }}"
                   class="facet-link flex justify-between items-center w-full text-sm
                        {% if item_data.active %}
                          text-blue-700 font-medium
                        {% else %}
                          text-gray-700 hover:text-blue-600
                        {% endif %}"
                   title="{{ item_name if h.truncate(item_name, 30) != item_name else '' }}">
                    <span class="truncate max-w-[160px]">
                        {{ h.truncate(item_name, 30) }}
                    </span>
                    <span class="facet-count flex items-center">
                        {% if item_data.active %}
                        <span class="inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-blue-600 rounded-full">
                            {{ item_data.count }}
                        </span>
                        {% else %}
                        <span class="text-xs text-gray-500 ml-1">
                            {{ item_data.count }}
                        </span>
                        {% endif %}
                    </span>
                </a>
            </li>
            {% endfor %}
        </ul>

        {# --- Botón "Mostrar más" --- #}
        {% if facet_data.items()|length > (show_more_facets or 10) %}
        <div class="facet-show-more px-4 py-2 bg-gray-50 text-right border-t border-gray-200">
            <a href="{{ h.more_facets_link(facet) }}"
               class="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline">
                <span>Mostrar más {{ title.lower() }}</span>
                <i class="icon-chevron-down ml-1 text-xs"></i>
            </a>
        </div>
        {% endif %}
    </section>

    {% endif %}
    {% endfor %}

</div>