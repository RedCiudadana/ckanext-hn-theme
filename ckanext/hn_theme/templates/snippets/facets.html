{# 
  facets.html - versi칩n personalizada para ckanext-hn-theme
  Este snippet genera las secciones del aside: Organizaciones, Grupos, Etiquetas, etc.
#}


{% set show_more_facets = g.show_more_facets or 10 %}

<!-- FACETS DEBUG: {{ facet_titles|length }} facets found -->

<div class="custom-facets">
  {% for facet in facet_titles %}
    {% set title = facet_titles[facet] %}
    {% set items = search_facets[facet].items() if search_facets[facet] else [] %}
    {% if items %}
      <section class="facet-section card mb-3 shadow-sm rounded-xl">
        <div class="facet-header bg-gray-100 p-2 border-b border-gray-300">
          <h4 class="text-base font-semibold text-gray-800">{{ title }}</h4>
        </div>
        <ul class="facet-list list-unstyled m-0 p-2">
          {% for item_name, item_data in items %}
            <li class="facet-item d-flex justify-between align-items-center py-1">
              <a href="{{ h.remove_url_param(facet, item_name) if item_data.active else h.add_url_param(facet, item_name) }}"
                 class="facet-link {% if item_data.active %}active text-blue-600 font-bold{% else %}text-gray-700{% endif %}">
                {{ h.truncate(item_name, 30) }}
              </a>
              <span class="facet-count text-sm text-gray-500">({{ item_data.count }})</span>
            </li>
          {% endfor %}
        </ul>

        {# Bot칩n "Mostrar m치s" #}
        {% if items|length > show_more_facets %}
          <div class="facet-show-more p-2 text-right">
            <a href="{{ h.more_facets_link(facet) }}" class="text-sm text-blue-500 hover:underline">
              Mostrar m치s {{ title.lower() }}
            </a>
          </div>
        {% endif %}
      </section>
    {% endif %}
  {% endfor %}
</div>
